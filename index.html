<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Nova League 3D ⚽</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
body,html {height:100%;overflow:hidden;font-family:'Arial Black',Arial,sans-serif;}
#menu{
  position:fixed;top:0;left:0;right:0;bottom:0;z-index:1000;
  background:radial-gradient(circle at center,#0a0a1f 0%,#1a1a2e 40%,#16213e 70%,#0f3460 100%);
  display:flex;flex-direction:column;justify-content:center;align-items:center;
  color:#fff;text-align:center;
}
#menu::before{
  content:'';position:absolute;top:0;left:0;right:0;bottom:0;
  background:linear-gradient(45deg,transparent 30%,rgba(0,212,255,0.1) 50%,transparent 70%);
  animation:shine 3s infinite;
}
@keyframes shine{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
#title{font-size:5vw;margin:0 0 1vw;text-shadow:0 0 30px #00d4ff,0 0 60px #00d4ff;font-weight:900;letter-spacing:0.1em;}
#subtitle{font-size:2vw;margin:1vw 0 3vw;color:#00d4ff;text-shadow:0 0 20px #00d4ff;}
.btn{
  background:linear-gradient(145deg,#ff6b6b,#ffd93d,#ff6b6b);
  background-size:200% 200%;animation:gradient 3s ease infinite;
  border:none;padding:2vw 4vw;font-size:1.8vw;border-radius:50px;cursor:pointer;
  color:#000;font-weight:900;text-transform:uppercase;letter-spacing:0.1em;
  box-shadow:0 20px 40px rgba(255,107,107,0.4),inset 0 1px 0 rgba(255,255,255,0.4);
  transition:all 0.3s ease;position:relative;overflow:hidden;
}
.btn:hover{transform:translateY(-5px) scale(1.05);box-shadow:0 25px 50px rgba(255,107,107,0.6);}
.btn:active{transform:translateY(-2px) scale(1.02);}
@keyframes gradient{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
#controls{font-size:1.2vw;margin-top:3vw;opacity:0.8;line-height:1.5;}
#game{display:none;}
#ui{position:fixed;top:20px;left:20px;right:20px;z-index:100;color:#fff;font-size:1.5vw;font-weight:bold;text-shadow:0 0 10px #000;}
</style>
</head>
<body>
<div id="menu">
  <h1 id="title">⚽ NOVA LEAGUE</h1>
  <h2 id="subtitle">ULTIMATE 3D FOOTBALL</h2>
  <button class="btn" onclick="NovaLeague.start()">▶ INICIAR PARTIDO</button>
  <div id="controls">
    WASD + SHIFT: Movimiento | E/Q: Potencia | F: Robo
  </div>
</div>
<div id="ui"></div>
<div id="game"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script>
const NovaLeague = {
  scene:null,camera:null,renderer:null,
  fieldWidth:140,fieldHeight:80,
  redTeam:[],blueTeam:[],player:null,ball:null,
  keys:{},powerCharge:0,charging:false,
  menu:null,gameDiv:null,ui:null,
  
  init(){
    this.menu = document.getElementById('menu');
    this.gameDiv = document.getElementById('game');
    this.ui = document.getElementById('ui');
    
    document.addEventListener('keydown',e=>this.keys[e.key.toLowerCase()]=true);
    document.addEventListener('keyup',e=>this.keys[e.key.toLowerCase()]=false);
    window.addEventListener('resize',()=>this.onResize());
  },
  
  start(){
    this.menu.style.opacity='0';
    setTimeout(()=>{
      this.menu.style.display='none';
      this.gameDiv.style.display='block';
      this.initGame();
    },800);
  },
  
  initGame(){
    // Renderer HD
    this.renderer = new THREE.WebGLRenderer({antialias:true,alpha:true});
    this.renderer.shadowMap.enabled = true;
    this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    this.renderer.setSize(window.innerWidth,window.innerHeight);
    this.gameDiv.appendChild(this.renderer.domElement);
    
    // Scene + Camera
    this.scene = new THREE.Scene();
    this.camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);
    
    // Skybox
    const skyGeo = new THREE.SphereGeometry(500,32,32);
    const skyMat = new THREE.MeshBasicMaterial({
      color:0x87CEEB,side:THREE.BackSide,transparent:true,opacity:0.3
    });
    this.scene.add(new THREE.Mesh(skyGeo,skyMat));
    
    // Luces profesionales
    const ambient = new THREE.AmbientLight(0x404040,0.6);
    this.scene.add(ambient);
    
    const sun = new THREE.DirectionalLight(0xffffff,1.2);
    sun.position.set(50,100,50);
    sun.castShadow = true;
    sun.shadow.mapSize.width = 2048;
    sun.shadow.mapSize.height = 2048;
    this.scene.add(sun);
    
    this.createField();
    this.createGrass();
    this.createPlayers();
    this.createBall();
    this.createUI();
    
    this.camera.position.set(0,20,30);
    this.animate();
  },
  
  createField(){
    // Campo base detallado
    const fieldGeo = new THREE.PlaneGeometry(this.fieldWidth,this.fieldHeight,50,50);
    const fieldMat = new THREE.MeshLambertMaterial({color:0x1a531a});
    const field = new THREE.Mesh(fieldGeo,fieldMat);
    field.rotation.x = -Math.PI/2;
    field.receiveShadow = true;
    this.scene.add(field);
    
    // Líneas profesionales
    const lineMat = new THREE.LineBasicMaterial({color:0xffffff,width:3});
    const points = [];
    
    // Límites
    points.push(new THREE.Vector3(-this.fieldWidth/2,0.02,-this.fieldHeight/2));
    points.push(new THREE.Vector3(this.fieldWidth/2,0.02,-this.fieldHeight/2));
    points.push(new THREE.Vector3(this.fieldWidth/2,0.02,this.fieldHeight/2));
    points.push(new THREE.Vector3(-this.fieldWidth/2,0.02,this.fieldHeight/2));
    points.push(points[0]);
    
    const lines = new THREE.BufferGeometry().setFromPoints(points);
    this.scene.add(new THREE.Line(lines,lineMat));
    
    // Línea central
    const centerLine = [new THREE.Vector3(0,0.02,-this.fieldHeight/2),new THREE.Vector3(0,0.02,this.fieldHeight/2)];
    this.scene.add(new THREE.Line(new THREE.BufferGeometry().setFromPoints(centerLine),lineMat));
    
    // Círculo central
    const circle = [];
    for(let i=0;i<=64;i++){
      const angle = i/64*Math.PI*2;
      circle.push(new THREE.Vector3(Math.sin(angle)*8,0.02,Math.cos(angle)*8));
    }
    this.scene.add(new THREE.LineLoop(new THREE.BufferGeometry().setFromPoints(circle),lineMat));
  },
  
  createGrass(){
    const grassGroup = new THREE.Group();
    const grassGeo = new THREE.PlaneGeometry(0.2,1.2,1,3);
    const grassMat = new THREE.MeshLambertMaterial({color:0x2d8a2d,transparent:true,opacity:0.8});
    
    for(let i=0;i<3000;i++){
      const grass = new THREE.Mesh(grassGeo,grassMat);
      grass.position.set(
        (Math.random()-0.5)*this.fieldWidth,
        0.6,
        (Math.random()-0.5)*this.fieldHeight
      );
      grass.rotation.y = Math.random()*Math.PI*2;
      grass.rotation.z = (Math.random()-0.5)*0.3;
      grass.castShadow = true;
      grassGroup.add(grass);
    }
    this.scene.add(grassGroup);
  },
  
  createPlayers(){
    const redPositions = [[-60,0],[-55,12],[-55,-12],[-50,20],[-50,-20],[-30,15],[-30,-15],[-20,8],[-20,-8],[0,0],[10,0]];
    const bluePositions = redPositions.map(([x,z])=>[-x,z]);
    
    this.redTeam = redPositions.map(([x,z])=>this.createDetailedPlayer(0xff4444,x,z,true));
    this.blueTeam = bluePositions.map(([x,z])=>this.createDetailedPlayer(0x4444ff,x,z,false));
    
    this.player = this.redTeam[9];
    this.player.userData.powerMeter = this.createPowerMeter();
    this.player.add(this.player.userData.powerMeter);
  },
  
  createDetailedPlayer(color,x,z,isPlayer=false){
    const group = new THREE.Group();
    
    // Cuerpo principal con detalles
    const bodyGeo = new THREE.CylinderGeometry(0.6,0.55,1.6,12);
    const bodyMat = new THREE.MeshLambertMaterial({color});
    const body = new THREE.Mesh(bodyGeo,bodyMat);
    body.position.y = 1.2;
    body.castShadow = true;
    
    // Cabeza detallada
    const headGeo = new THREE.SphereGeometry(0.4,16,12);
    const headMat = new THREE.MeshLambertMaterial({color:0xffdbac});
    const head = new THREE.Mesh(headGeo,headMat);
    head.position.y = 2.4;
    head.castShadow = true;
    
    // Pelo realista
    const hairGeo = new THREE.SphereGeometry(0.42,12,8);
    const hairMat = new THREE.MeshLambertMaterial({color:0x2d1b12});
    const hair = new THREE.Mesh(hairGeo,hairMat);
    hair.position.y = 2.55;
    
    // Brazos detallados
    for(let side of [-0.75,0.75]){
      const armGeo = new THREE.CylinderGeometry(0.12,0.15,1.1,8);
      const arm = new THREE.Mesh(armGeo,new THREE.MeshLambertMaterial({color:0xcccccc}));
      arm.rotation.z = Math.PI/2;
      arm.position.set(side,1.4,0);
      arm.castShadow = true;
      group.add(arm);
    }
    
    // Piernas + botas profesionales
    for(let side of [-0.25,0.25]){
      const legGeo = new THREE.CylinderGeometry(0.16,0.18,1.2,10);
      const leg = new THREE.Mesh(legGeo,new THREE.MeshLambertMaterial({color:0x333333}));
      leg.position.set(side,0.5,0);
      leg.castShadow = true;
      group.add(leg);
      
      const bootGeo = new THREE.BoxGeometry(0.4,0.25,0.8);
      const bootMat = new THREE.MeshLambertMaterial({color:color===0xff4444?0x1a4fff:0xff1a1a});
      const boot = new THREE.Mesh(bootGeo,bootMat);
      boot.position.set(side,0.15,0.45);
      boot.castShadow = true;
      group.add(boot);
    }
    
    group.add(body,head,hair);
    group.position.set(x,0,z);
    group.scale.set(1.1,1.1,1.1);
    group.castShadow = true;
    group.userData = {color,speed:0.12,homeX:x,homeZ:z,hasBall:false};
    this.scene.add(group);
    return group;
  },
  
  createPowerMeter(){
    const group = new THREE.Group();
    const bgGeo = new THREE.BoxGeometry(1.8,0.25,0.12);
    const bgMat = new THREE.MeshBasicMaterial({color:0x111111,transparent:true,opacity:0.9});
    const bg = new THREE.Mesh(bgGeo,bgMat);
    
    const barGeo = new THREE.BoxGeometry(1.75,0.22,0.1);
    const barMat = new THREE.MeshBasicMaterial({color:0x00ff88});
    const bar = new THREE.Mesh(barGeo,barMat);
    
    group.add(bg,bar);
    group.userData = {bar};
    group.position.y = 3.4;
    return group;
  },
  
  createBall(){
    const ballGeo = new THREE.SphereGeometry(0.5,20,16);
    const ballMat = new THREE.MeshLambertMaterial({color:0xffffff});
    this.ball = new THREE.Mesh(ballGeo,ballMat);
    this.ball.position.set(0,0.6,0);
    this.ball.castShadow = true;
    this.ball.userData = {vx:0,vz:0,holder:null};
    this.scene.add(this.ball);
  },
  
  createUI(){
    // Marcador
    const scoreBoard = document.createElement('div');
    scoreBoard.style.cssText = 'position:absolute;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.8);padding:15px 30px;border-radius:15px;color:#fff;font-size:2vw;letter-spacing:2px;box-shadow:0 10px 30px rgba(0,0,0,0.5);';
    scoreBoard.id = 'scoreboard';
    this.ui.appendChild(scoreBoard);
  },
  
  stealBall(){
    if(this.ball.userData.holder && this.ball.userData.holder !== this.player){
      const dx = this.ball.position.x - this.player.position.x;
      const dz = this.ball.position.z - this.player.position.z;
      const dist = Math.sqrt(dx*dx + dz*dz);
      if(dist < 2.2){
        this.ball.userData.holder.userData.hasBall = false;
        this.ball.userData.holder = this.player;
        this.player.userData.hasBall = true;
      }
    }
  },
  
  updatePlayers(){
    const allPlayers = [...this.redTeam,...this.blueTeam];
    allPlayers.forEach(p=>{
      if(p === this.player || p.userData.hasBall) return;
      
      const dx = this.ball.position.x - p.position.x;
      const dz = this.ball.position.z - p.position.z;
      const distBall = Math.sqrt(dx*dx + dz*dz);
      
      if(distBall > 2.5){
        p.position.x += (dx/distBall)*p.userData.speed;
        p.position.z += (dz/distBall)*p.userData.speed;
      }else{
        const angle = (allPlayers.indexOf(p)/allPlayers.length)*Math.PI*2;
        const targetX = this.ball.position.x + Math.cos(angle)*5;
        const targetZ = this.ball.position.z + Math.sin(angle)*5;
        const tx = targetX - p.position.x;
        const tz = targetZ - p.position.z;
        const td = Math.sqrt(tx*tx + tz*tz);
        p.position.x += (tx/td)*p.userData.speed*0.4;
        p.position.z += (tz/td)*p.userData.speed*0.4;
      }
      
      p.position.x += (p.userData.homeX - p.position.x)*0.008;
      p.position.z += (p.userData.homeZ - p.position.z)*0.008;
      p.rotation.y = Math.atan2(dx,dz);
      
      this.limitToField(p);
    });
  },
  
  limitToField(obj){
    obj.position.x = Math.max(-this.fieldWidth/2+2,Math.min(this.fieldWidth/2-2,obj.position.x));
    obj.position.z = Math.max(-this.fieldHeight/2+2,Math.min(this.fieldHeight/2-2,obj.position.z));
  },
  
  updateUI(){
    const redScore = this.redTeam.filter(p=>p.userData.hasBall).length;
    const blueScore = this.blueTeam.filter(p=>p.userData.hasBall).length;
    document.getElementById('scoreboard').innerHTML = `ROJOS ${redScore} - ${blueScore} AZULES`;
  },
  
  animate(){
    requestAnimationFrame(()=>this.animate());
    
    // Controles
    if(this.keys['f']) this.stealBall();
    if(this.keys['a']) this.player.rotation.y += 0.06;
    if(this.keys['d']) this.player.rotation.y -= 0.06;
    const speed = this.keys['shift'] ? 0.45 : 0.25;
    if(this.keys['w']){
      this.player.position.x += Math.sin(this.player.rotation.y)*speed;
      this.player.position.z += Math.cos(this.player.rotation.y)*speed;
    }
    if(this.keys['s']){
      this.player.position.x -= Math.sin(this.player.rotation.y)*speed*0.7;
      this.player.position.z -= Math.cos(this.player.rotation.y)*speed*0.7;
    }
    
    this.limitToField(this.player);
    
    // Potencia
    if((this.keys['e']||this.keys['q']) && !this.charging){
      this.charging = true;
      this.player.userData.powerMeter.visible = true;
    }
    if(this.charging){
      this.powerCharge = Math.min(1,this.powerCharge+0.025);
      const meter = this.player.userData.powerMeter.userData;
      meter.bar.scale.x = this.powerCharge;
      meter.bar.position.x = (this.powerCharge-1)*0.875;
      meter.bar.material.color.setHSL(0.33-this.powerCharge*0.33,1,0.5);
    }
    if(!this.keys['e'] && !this.keys['q'] && this.charging){
      const power = this.powerCharge*0.8;
      this.ball.userData.vx = Math.sin(this.player.rotation.y)*power;
      this.ball.userData.vz = Math.cos(this.player.rotation.y)*power;
      this.ball.userData.holder = null;
      this.player.userData.hasBall = false;
      this.charging = false;
      this.powerCharge = 0;
      this.player.userData.powerMeter.visible = false;
    }
    
    // Balón
    if(!this.ball.userData.holder){
      this.ball.position.x += this.ball.userData.vx;
      this.ball.position.z += this.ball.userData.vz;
      this.ball.userData.vx *= 0.97;
      this.ball.userData.vz *= 0.97;
    }else{
      const holder = this.ball.userData.holder;
      this.ball.position.x = holder.position.x + Math.sin(holder.rotation.y)*1;
      this.ball.position.z = holder.position.z + Math.cos(holder.rotation.y)*1;
    }
    this.limitToField(this.ball);
    
    this.updatePlayers();
    this.updateUI();
    
    // Cámara cinematográfica
    const camDist = 22, camHeight = 12;
    this.camera.position.x = this.player.position.x - Math.sin(this.player.rotation.y)*camDist;
    this.camera.position.z = this.player.position.z - Math.cos(this.player.rotation.y)*camDist;
    this.camera.position.y = this.player.position.y + camHeight;
    this.camera.lookAt(this.player.position.x,this.player.position.y+2,this.player.position.z);
    
    this.renderer.render(this.scene,this.camera);
  },
  
  onResize(){
    this.camera.aspect = window.innerWidth / window.innerHeight;
    this.camera.updateProjectionMatrix();
    this.renderer.setSize(window.innerWidth,window.innerHeight);
  }
};

NovaLeague.init();
</script>
</body>
</html>
